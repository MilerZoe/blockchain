# 导入私钥源码解析

前端导入私钥请求代码，这个代码比较简单，这里不做深入的分析

    <script>
      import { Toast } from 'mint-ui'
      export default{
        props:['isImportShow'],
        data(){
          return {
            isInput:false,  //是否已经输入
            isChooseFile:false, //是否选择文件
            privateKey:'', //私钥地址或者私钥串
            password:'', //密码
          }
        },
        methods:{
          closePop(index){
            if(index){
              this.$emit('closeImportShow',true);
            }else{
              this.$emit('closeImportShow',false);
            }
            this.isInput=false;  //是否已经输入
              this.isChooseFile=false; //是否选择文件
              this.privateKey=''; //私钥地址或者私钥串
              this.password=''; //密码
          },

          checkFile:function () {
            if(!this.isInput){
              this.requestFilePath();
            }
          },

          requestFilePath:function () {
            this.$ipcRenderer.send('generate-file-path','filePath');
            this.responseFilePath();
          },

          responseFilePath:function () {
            let _this = this;
            this.$ipcRenderer.on('generate-file-path-back',data => {
              _this.$ipcRenderer.detach('generate-file-path-back')
              console.log(data);
              if(data && data.success) {
                _this.privateKey = data.filePath[0];
                _this.isChooseFile = true
                _this.$ipcRenderer.detach('generate-file-path-back');
              }
            })
          },
          requestImportKey:function () {
            if(!this.privateKey){
              Toast('请输入私钥或导入私钥文件')
              return false;
            }
            if(!this.password){
              Toast('请输入密码')
              return false;
            }
            let privateKey = '';
            let privateKeyPath = '';
            if(!this.isChooseFile){
              privateKey = this.privateKey
            }else{
              privateKeyPath = this.privateKey
            }
            let params = {
              password:this.password,
              privateKey:privateKey,
              privateKeyPath:privateKeyPath
            }
            console.log(params)
            this.$ipcRenderer.send('import-privateKey',params);
            this.responseImportKey();
          },
          responseImportKey:function () {
            let _this = this;
            this.$ipcRenderer.on('import-privateKey-back',data => {
              _this.$ipcRenderer.detach('import-privateKey-back')
              console.log(data);
              if(data && data.success) {
                Toast('导入成功');
                _this.closePop(1);
              }else{
                if(data.errorCode == 600) {
                  Toast('数据初始化失败，请重试')
                }
                if(data.errorCode == 601) {
                  Toast('数据初始化失败，请重试')
                }
                if(data.errorCode == 602) {
                  Toast('数据初始化失败，请重试')
                }
                if(data.errorCode == 603) {
                  Toast('该用户已经存在，禁止重复导入，请您勿再重复导入')
                }
                if(data.errorCode == 604) {
                  Toast("导入过程中生成keystore失败，请重试");
                }
              }
            })
          }
        },

        watch:{
          privateKey:function (oldVal, Val) {
            if(this.privateKey){
              this.isInput = true;
            }else{
              this.isInput = false;
            }
          }
        }
      }
    </script>

